<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!--<link rel=stylesheet href='style.css' type='text/css'>-->
<head>
    <title>AIP cluster database, table {{table}}. Key editor</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Geany 1.22" />
    <script type="text/javascript" charset="utf8" src="/static/jquery.min.js"></script>
    <script language="javascript">
    function modifyKeyClass(){
        //alert('Modify key class'+$('#key_class_list').val());
        $.post("get_key_description?key="+$("#key_selector").val()+"&key_class="+$('#key_class_list').val(),function(response){
             var values = response.split(',');
             $("#description").text(values[0]);
             $("#key_format").text(values[1]);
        })
    }
    function refillSelect(id, values){
        var select_class = $(id);
        select_class.empty();
        if (values.length > 0){
            for (var i = 0; i < values.length; i++){
                var opt = document.createElement('option');
                opt.value = values[i];
                opt.textContent = values[i];
                select_class.append(opt);
            }
        }
        else{
            var opt = document.createElement('option');
            opt.value = 'none';
            opt.textContent = '-';
            select_class.append(opt);
        }
    }
    function modifyKey(){
        //alert('Modify key');
        $.post("get_key_class_list?key="+$("#key_selector").val(),function(response){
            var values = response.split(',');
            select_class = document.getElementById('key_class_list');
            select_class.onchange = null;
            refillSelect('#key_class_list', values);
            select_class = document.getElementById('key_class_list');
            select_class.onchange = modifyKeyClass;
            select_class.selectedIndex = 0;
            modifyKeyClass()
        })
    }
    function winOnLoad(){
        modifyKey();
    //    modifyKeyClass();
    }
    window.onload = winOnLoad;
    </script>
</head>

<body>
    <a href='index'>Main menu</a>
    <a href='edit_tables'>Back to tables list</a>
    <a href='edit_table?table={{table}}'>Back to table {{table}}</a>
    <h1>Table {{table}}</h1>
    <form method="post" action="edit_key_update">
          <input type="hidden" name="table" value="{{table}}" />
          <input type="hidden" name="mode" value="{{mode}}" />
          {% if mode == 'edit' %}
              <label for="key">key: </label>
              <input type="text" name="key" value="{{key}}" readonly/><br>
              <label for="key_class">key_class: </label>
              <input type="text" name="key_class" value="{{key_class}}" readonly/><br>
          {% else %}
              <label for="key">key: </label>
              <select name="key" id="key_selector" onchange="modifyKey()">
                  {% for key_item in key_list %}
                    {% if key_item == key %}
                        <option value={{key_item}} selected>{{key_item}}</option>
                    {% else %}
                        <option value={{key_item}}>{{key_item}}</option>
                    {% endif %}
                  {% endfor %}
              </select>
              <label for="key_class">key_class: </label>
              <select name="key_class" id="key_class_list"></select>
          {% endif %}
          <br>
          <div>Description: </div><div id="description"></div>
          <div>Format: </div><div id="key_format"></div>
          <label for="reference_column">reference_column: </label>
          <input type="text" name="reference_column" value="{{reference_column}}" /><br>
          <label for="error_column_low">error_column_low: </label>
          <input type="text" name="error_column_low" value="{{error_column_low}}" /><br>
          <label for="error_column_high">error_column_high: </label>
          <input type="text" name="error_column_high" value="{{error_column_high}}" /><br>
          <label for="comment">comment: </label>
          <input type="text" name="comment" value="{{comment}}" /><br>
          <button type="submit">Submit changes</button>
    </form>

</body>
</html>
