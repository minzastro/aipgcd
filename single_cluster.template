<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<link rel=stylesheet href='static/style.css' type='text/css'>
<link rel="stylesheet" type="text/css" href="/static/DataTables/media/css/jquery.dataTables.css">

<head>
    <title>{{source_id}} from {{source}} ({{uid}})</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Geany 1.22" />
    <script type="text/javascript" charset="utf8" src="/static/DataTables/media/js/jquery.js"></script>
    <script type="text/javascript" charset="utf8" src="/static/DataTables/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="/static/aipgcd.js"></script>
    <script type="text/javascript" charset="utf8" src="/static/samp.js"></script>
    <!--<script type="text/javascript" charset="utf8" src="/static/jquery.min.js"></script>-->
    <script type="text/javascript" charset="utf8" language="javascript">
        function xid_change(){
                $.post('single_cluster_update_xid', {uid: {{uid}},
                                                         xid: document.getElementById('detection_status').value});
        }

        $(window).load(function(){

            document.getElementById('detection_status').value = {{xidflag}};
            $(".header").click(function () {
                $header = $(this);
                //getting the next element
                $content = $header.next();
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(200, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        return $content.is(":visible") ? "Collapse" : "Expand";
                    });
                });
            });
            $('#change_comment').click(function(){

                $.post('single_cluster_update_comment', {uid: {{uid}},
                                                         comment: document.getElementById('comment').value});
                var button = document.getElementById('change_comment');
                button.value = 'Saved!';
                setTimeout(function(){button.value = 'Submit changes'}, 1000);
            });
            $('#key_values').DataTable({
                ordering: true,
                "scrollY":        window.innerHeight - 200,
                "scrollCollapse": true,
                paging: false
            });
        });
    </script>
</head>

<body>
<div style='float:left'>
    <a href='index'>Main menu</a>
<h1>{{source_id}} from {{source}} ({{uid}})</h1>
<p>Detection status
  <select id="detection_status" onchange="xid_change()">
      <option value='-1'>-1: Not a cluster</option>
      <option value='0'>0: Not identified</option>
      <option value='1'>1: Confirmed cluster</option>
      <option value='2'>2: Confirmed cluster with spectra</option>
  </select>
</p>
<div><a target="_blank" href="http://ned.ipac.caltech.edu/cgi-bin/objsearch?in_csys=Equatorial&in_equinox=J2000.0&lon={{ '%.6f' |format(ra)}}d&lat={{ '%.6f' |format(dec)}}d&radius=2.0&hconst=73&omegam=0.27&omegav=0.73&corr_z=1&search_type=Near+Position+Search&z_constraint=Unconstrained&ot_include=ANY&nmp_op=ANY&out_csys=Equatorial&out_equinox=J2000.0&obj_sort=Distance+to+search+center&of=pre_text&list_limit=15&img_stamp=YES">NED search</a></div>

<div><a target="_blank" href="http://simbad.u-strasbg.fr/simbad/sim-coo?Coord={{ '%.6f' |format(ra)}}d{{ '%.6f' |format(dec)}}d&CooFrame=ICRS&CooEpoch=2000">SIMBAD search</a></div>

<input type='button' onclick='samp_table("key_values", true)' value='Send keys to SAMP'/>
<table id="key_values" class="compact hover" width=500 columns='SSSSSS'>
    <caption>Main parameters</caption>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Value</th>
            <th>Error (lower)</th>
            <th>Error (upper)</th>
            <th>Source</th>
        </tr>
    </thead>
    <tbody>
    {%for par in params%}
    <tr>
        <td>{{par.name}}</td>
        <td>{{par.desc}}</td>
        <td>{{par.value}}</td>
        <td>{{par.err_low}}</td>
        <td>{{par.err_high}}</td>
        <td>{{par.source}}</td>
    </tr>
    {%endfor%}
    </tbody>
</table>

<hr>
<h1>Comment</h1>
<div>
<textarea id="comment" name="comment" cols="40" rows="5">{{comment}}</textarea>
<input type="button" id="change_comment" value="Submit changes"></input>
</div>
{%for table in tables%}
<hr>
<h1>{{table.title}}</h1>
{{table.html}}
<div class="container">
<div class="header"><span>See all data</span></div>
<div class="content">{{table.full_table}}</div>
</div>
{%endfor%}
</div>

</body>

</html>
